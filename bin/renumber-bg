#!/bin/zsh
set -euf

srcdir="$HOME/Pictures/shared"
bgdir="$HOME/Pictures/wallpapers"
blacklist="$bgdir/.blacklist"

if [ ! -f "$blacklist" ]; then
  touch "$blacklist"
fi

find -H "$bgdir" -not -path '*/\.*' \( -type f -o -type l \) -delete
selection=("${(@f)$(find -H "$srcdir" -type f -name '*.jpg' -o -name '*.png')}")
counter=1
for bg in ${selection:A}; do
  if grep -q "$bg" "$blacklist"; then
    continue
  fi
  ln -s "$bg" "${bgdir}/wallpaper_$(printf '%04d' $counter).${bg:e}"
  counter=$((counter+1))
done
rotate-bg
