#!/bin/sh
set -euf

bgdir="${HOME}/Pictures/wallpapers"
blacklist="${bgdir}/.blacklist"

addfile() {
  local file=$(readlink "$1")
  if [ ! -f "$file" ] || ([ -f "$blacklist" ] && grep -q "$file" "$blacklist"); then
    return
  fi
  printf '%s\n' "$file" | tee -a "$blacklist"
}

if [ $# -eq 0 ]; then
  file=$(gsettings get org.gnome.desktop.background picture-uri|sed -e "s/^'file:\/\///" -e "s/'$//")
  addfile "$file"
else
  for base in "$@"; do
    base=$(printf %04d "$base")
    base="${bgdir}/wallpaper_${base}"
    if [ -f "${base}.png" ]; then
      addfile "${base}.png"
    fi
    if [ -f "${base}.jpg" ]; then
      addfile "${base}.jpg"
    fi
  done
fi
renumber-bg
